<!doctype html>
<title>{% block title %}{% endblock %} - Flaskr</title>
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Kanit&family=Montserrat&family=Open+Sans:wght@500&display=swap" rel="stylesheet">

<body>
    <section>
        <span class="overlay"></span>
        <div class="modal-box">
            <div class="modal-top">
                <div class="modal-header">
                    <div class="modal-title">
                        <div class="modal-title-box">
                            <div class="modal-title-words">
                                Placeholder
                            </div>
                            <div class="modal-medicine">
                                <svg width="80px" height="80px" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" fill="#000000">
                                    <g id="SVGRepo_bgCarrier" stroke-width="0" />
                                    <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" />
                                    <g id="SVGRepo_iconCarrier">
                                        <defs>
                                            <style>
                                                .cls-1 {
                                                    fill: #11998e;
                                                }

                                                .cls-2 {
                                                    fill: #38ef7d;
                                                    ;
                                                }
                                            </style>
                                        </defs>
                                        <g data-name="24. Drug" id="_24._Drug">
                                            <path class="cls-1"
                                                d="M23.12,8.71,20.41,6H21a2,2,0,0,0,2-2V2a2,2,0,0,0-2-2H5A2,2,0,0,0,3,2V4A2,2,0,0,0,5,6h.59L2.88,8.71A3,3,0,0,0,2,10.83V29a3,3,0,0,0,3,3H19a1,1,0,0,0,0-2H5a1,1,0,0,1-1-1V27H17a1,1,0,0,0,0-2H4V13H23a1,1,0,0,0,1-1V10.83A3,3,0,0,0,23.12,8.71ZM5,2H21V4H5Zm17,9H4v-.17a1,1,0,0,1,.29-.71L8.41,6h9.18l4.12,4.12a1,1,0,0,1,.29.71Z" />
                                            <path class="cls-2" d="M16,18H14V16a1,1,0,0,0-2,0v2H10a1,1,0,0,0,0,2h2v2a1,1,0,0,0,2,0V20h2a1,1,0,0,0,0-2Z" />
                                            <path class="cls-2" d="M29,25H21a1,1,0,0,1,0-2h8a1,1,0,0,1,0,2Z" />
                                            <path class="cls-1" d="M25,32a5,5,0,0,1-5-5V20a5,5,0,0,1,10,0v7A5,5,0,0,1,25,32Zm0-15a3,3,0,0,0-3,3v7a3,3,0,0,0,6,0V20A3,3,0,0,0,25,17Z" />
                                        </g>
                                    </g>
                                </svg>
                            </div>
                        </div>

                        <div class="stars-container" style="display: flex;">
                        </div>
                        <div class="component-box">
                            <div class="component1">

                            </div>
                            <div class="component-percent1">

                            </div>
                        </div>

                        <div class="component-box">
                            <div class="component2">

                            </div>
                            <div class="component-percent2">

                            </div>
                        </div>

                        <div class="component-box">
                            <div class="component3">

                            </div>
                            <div class="component-percent3">

                            </div>
                        </div>
                    </div>
                    <div class="modal-sym">
                        <div class="modal-sym-words">

                        </div>
                        <div class="modal-symInfo">

                        </div>
                    </div>
                </div>
                <div class="buttons">
                    <button class="close-btn">
                        <svg fill="#ffffff" width="50px" height="50px" viewBox="0 0 96 96" xmlns="http://www.w3.org/2000/svg">
                            <title />
                            <g>
                                <path d="M30,60H6A6,6,0,0,0,6,72H24V90a6,6,0,0,0,12,0V66A5.9966,5.9966,0,0,0,30,60Z" />
                                <path d="M90,60H66a5.9966,5.9966,0,0,0-6,6V90a6,6,0,0,0,12,0V72H90a6,6,0,0,0,0-12Z" />
                                <path d="M66,36H90a6,6,0,0,0,0-12H72V6A6,6,0,0,0,60,6V30A5.9966,5.9966,0,0,0,66,36Z" />
                                <path d="M30,0a5.9966,5.9966,0,0,0-6,6V24H6A6,6,0,0,0,6,36H30a5.9966,5.9966,0,0,0,6-6V6A5.9966,5.9966,0,0,0,30,0Z" />
                            </g>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="modal-bottom">
                <div class="modal-bottom-container-middle">
                    <div class="modal-middle-split">
                        <div class="modal-bottom-header">
                            <div class="modal-header-adverse">
                                Placeholder
                            </div>
                        </div>
                        <div class="modal-adverseInfo">
                
                        </div>
                        <div class="modal-sim">
                            
                        </div>
                    </div>
                
                </div>
                <div class="modal-bottom-container">
                    <div class="modal-bottom-header">
                        <div class="modal-header-positive">
                            Placeholder
                        </div>
                    </div>
                    <div class="modal-review">
                        <div class="positive-review1">

                        </div>
                        <div class="stars-pos1" style="display: flex;">
                        </div>
                    </div>
                    <div class="modal-review">
                        <div class="positive-review2">

                        </div>
                        <div class="stars-pos2" style="display: flex;">
                        </div>
                    </div>
                </div>
                <div class="modal-bottom-container-right">
                    <div class="modal-review">
                        <div class="negative-review1">

                        </div>
                        <div class="stars-neg1" style="display: flex;">
                        </div>
                    </div>
                    <div class="modal-review">
                        <div class="negative-review2">

                        </div>
                        <div class="stars-neg2" style="display: flex;">
                        </div>
                    </div>
                </div>
                
            </div>
        </div>
    </section>
    <canvas id="stars" width="300" height="300"></canvas>
    <div class="full-body-container">
        <div class="top-text">
            <div class="main-top">
                <div class="top-logo">
                    <img style="border-radius: 200px;" src="{{ url_for('static', filename='images/diagnosys.png') }}" />
                </div>
                <div class="info-section">
                    <div class="info-icon">
                        <svg onclick="handleInfoClick()" fill="#11998e" width="64px" height="64px" viewBox="0 0 1920 1920" xmlns="http://www.w3.org/2000/svg">
                            <g id="SVGRepo_bgCarrier" stroke-width="0" />
                            <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" />
                            <g id="SVGRepo_iconCarrier">
                                <path
                                    d="M960 0c530.193 0 960 429.807 960 960s-429.807 960-960 960S0 1490.193 0 960 429.807 0 960 0Zm0 101.053c-474.384 0-858.947 384.563-858.947 858.947S485.616 1818.947 960 1818.947 1818.947 1434.384 1818.947 960 1434.384 101.053 960 101.053Zm-42.074 626.795c-85.075 39.632-157.432 107.975-229.844 207.898-10.327 14.249-10.744 22.907-.135 30.565 7.458 5.384 11.792 3.662 22.656-7.928 1.453-1.562 1.453-1.562 2.94-3.174 9.391-10.17 16.956-18.8 33.115-37.565 53.392-62.005 79.472-87.526 120.003-110.867 35.075-20.198 65.9 9.485 60.03 47.471-1.647 10.664-4.483 18.534-11.791 35.432-2.907 6.722-4.133 9.646-5.496 13.23-13.173 34.63-24.269 63.518-47.519 123.85l-1.112 2.886c-7.03 18.242-7.03 18.242-14.053 36.48-30.45 79.138-48.927 127.666-67.991 178.988l-1.118 3.008a10180.575 10180.575 0 0 0-10.189 27.469c-21.844 59.238-34.337 97.729-43.838 138.668-1.484 6.37-1.484 6.37-2.988 12.845-5.353 23.158-8.218 38.081-9.82 53.42-2.77 26.522-.543 48.24 7.792 66.493 9.432 20.655 29.697 35.43 52.819 38.786 38.518 5.592 75.683 5.194 107.515-2.048 17.914-4.073 35.638-9.405 53.03-15.942 50.352-18.932 98.861-48.472 145.846-87.52 41.11-34.26 80.008-76 120.788-127.872 3.555-4.492 3.555-4.492 7.098-8.976 12.318-15.707 18.352-25.908 20.605-36.683 2.45-11.698-7.439-23.554-15.343-19.587-3.907 1.96-7.993 6.018-14.22 13.872-4.454 5.715-6.875 8.77-9.298 11.514-9.671 10.95-19.883 22.157-30.947 33.998-18.241 19.513-36.775 38.608-63.656 65.789-13.69 13.844-30.908 25.947-49.42 35.046-29.63 14.559-56.358-3.792-53.148-36.635 2.118-21.681 7.37-44.096 15.224-65.767 17.156-47.367 31.183-85.659 62.216-170.048 13.459-36.6 19.27-52.41 26.528-72.201 21.518-58.652 38.696-105.868 55.04-151.425 20.19-56.275 31.596-98.224 36.877-141.543 3.987-32.673-5.103-63.922-25.834-85.405-22.986-23.816-55.68-34.787-96.399-34.305-45.053.535-97.607 15.256-145.963 37.783Zm308.381-388.422c-80.963-31.5-178.114 22.616-194.382 108.33-11.795 62.124 11.412 115.76 58.78 138.225 93.898 44.531 206.587-26.823 206.592-130.826.005-57.855-24.705-97.718-70.99-115.729Z"
                                    fill-rule="evenodd" />
                            </g>
                        </svg>
                    </div>
                </div>
            </div>
            
            <div class="main-content">
                <div class="main-left">
                    <div class="medications-sidebar">
                        <div class="Card">
                            <div class="filters">
                                <label>Filters<span class="underline"></span></label>
                                <div class="selectors">
                                    <form id="app-cover">
                                        <div id="select-box">
                                            <input type="checkbox" id="options-view-button">
                                            <div id="select-button" class="brd">
                                                <div id="selected-value">
                                                    <span>Sex</span>
                                                    <svg fill="#ffffff" width="24px" height="24px" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                        <path
                                                            d="M7.293,7.707a1,1,0,0,1,0-1.414l4-4a1,1,0,0,1,1.414,0l4,4a1,1,0,1,1-1.414,1.414L12,4.414,8.707,7.707A1,1,0,0,1,7.293,7.707Zm0,10,4,4a1,1,0,0,0,1.414,0l4-4a1,1,0,0,0-1.414-1.414L12,19.586,8.707,16.293a1,1,0,1,0-1.414,1.414Z" />
                                                    </svg>
                                                </div>
                                            </div>
                                            <div id="options">
                                                <div class="option">
                                                    <input class="s-c top" type="radio" name="gender" value="male">
                                                    <input class="s-c bottom" type="radio" name="gender" value="male">
                                                    <span class="label">Male</span>
                                                    <span class="opt-val">Male</span>
                                                </div>
                                                <div class="option">
                                                    <input class="s-c top" type="radio" name="gender" value="female">
                                                    <input class="s-c bottom" type="radio" name="gender" value="female">
                                                    <span class="label">Female</span>
                                                    <span class="opt-val">Female</span>
                                                </div>
                                                <div id="option-bg"></div>
                                            </div>
                                        </div>
                                    </form>
                                    <form id="app-cover">
                                        <div id="select-box">
                                            <input type="checkbox" id="optionsAge-view-button">
                                            <div id="select-button" class="brd">
                                                <div id="selectedAge-value">
                                                    <span>Age</span>
                                                    <svg fill="#ffffff" width="24px" height="24px" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                        <path
                                                            d="M7.293,7.707a1,1,0,0,1,0-1.414l4-4a1,1,0,0,1,1.414,0l4,4a1,1,0,1,1-1.414,1.414L12,4.414,8.707,7.707A1,1,0,0,1,7.293,7.707Zm0,10,4,4a1,1,0,0,0,1.414,0l4-4a1,1,0,0,0-1.414-1.414L12,19.586,8.707,16.293a1,1,0,1,0-1.414,1.414Z" />
                                                    </svg>
                                                </div>
                                            </div>
                                            <div id="optionsAge">
                                                <div class="optionAge">
                                                    <input class="s-c top" type="radio" name="Age" value="15">
                                                    <input class="s-c bottom" type="radio" name="Age" value="15">
                                                    <span class="label">10-20</span>
                                                    <span class="opt-val">10-20</span>
                                                </div>
                                                <div class="optionAge">
                                                    <input class="s-c top" type="radio" name="Age" value="25">
                                                    <input class="s-c bottom" type="radio" name="Age" value="25">
                                                    <span class="label">21-30</span>
                                                    <span class="opt-val">21-30</span>
                                                </div>
                                                <div class="optionAge">
                                                    <input class="s-c top" type="radio" name="Age" value="35">
                                                    <input class="s-c bottom" type="radio" name="Age" value="35">
                                                    <span class="label">31-40</span>
                                                    <span class="opt-val">31-40</span>
                                                </div>
                                                <div class="optionAge">
                                                    <input class="s-c top" type="radio" name="Age" value="45">
                                                    <input class="s-c bottom" type="radio" name="Age" value="45">
                                                    <span class="label">41-50</span>
                                                    <span class="opt-val">51-60</span>
                                                </div>
                                                <div class="optionAge">
                                                    <input class="s-c top" type="radio" name="Age" value="55">
                                                    <input class="s-c bottom" type="radio" name="Age" value="55">
                                                    <span class="label">51-60</span>
                                                    <span class="opt-val">51-60</span>
                                                </div>
                                                <div class="optionAge">
                                                    <input class="s-c top" type="radio" name="Age" value="65">
                                                    <input class="s-c bottom" type="radio" name="Age" value="65">
                                                    <span class="label">61-70</span>
                                                    <span class="opt-val">61-70</span>
                                                </div>
                                                <div class="optionAge">
                                                    <input class="s-c top" type="radio" name="Age" value="75">
                                                    <input class="s-c bottom" type="radio" name="Age" value="75">
                                                    <span class="label">71-80</span>
                                                    <span class="opt-val">71-80</span>
                                                </div>
                                                <div class="optionAge">
                                                    <input class="s-c top" type="radio" name="Age" value="85">
                                                    <input class="s-c bottom" type="radio" name="Age" value="85">
                                                    <span class="label">81-90</span>
                                                    <span class="opt-val">81-90</span>
                                                </div>
                                                <div class="optionAge">
                                                    <input class="s-c top" type="radio" name="Age" value="95">
                                                    <input class="s-c bottom" type="radio" name="Age" value="95">
                                                    <span class="label">91-100</span>
                                                    <span class="opt-val">91-100</span>
                                                </div>
                                                <div id="optionAge-bg"></div>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                            <div class="CardInner">
                                <label>Enter your medications<span class="underline"></span></label>
                                <div class="container">
                                    <div class="Icon">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#657789" stroke-width="3" stroke-linecap="round"
                                            stroke-linejoin="round" class="feather feather-search">
                                            <circle cx="11" cy="11" r="8" />
                                            <line x1="21" y1="21" x2="16.65" y2="16.65" />
                                        </svg>
                                    </div>
                                    <div class="InputContainer">
                                        <input type="text" placeholder="ex: ibuprofen" id="medInput" />
                                        <div id="autocomplete-list" class="autocomplete-items"></div>
                                    </div>
                                </div>
                                <div id="tag-list" class="tag-list">
                                    <!-- Tags will be dynamically inserted here -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <button class="search-button-update" style="display: none;" onClick="sendUpdateQuery()">Update Query</button>
                </div>

                <div class="search-and-answers">
                    <div class="search">
                        <div class="form__group field">
                            <textarea class="form__field" id="filter-text-val" placeholder="Name" name="name" id='name' required autocomplete="off"></textarea>
                            <label for="name" class="form__label">Enter your symptoms</label>
                        </div>
                        <!-- <div class="input-box" onclick="sendFocus()">
                                                            <img src="{{ url_for('static', filename='images/mag.png') }}" />
                                                            <input placeholder="Enter your symptoms and medications" id="filter-text-val" class="">
                                                        </div> -->
                        <button class="search-button" onClick="filterTextDrug()">Search</button>
                    </div>
                    <div id="answer-box">
                        <!-- Cards will be dynamically inserted here -->
                    </div>
                </div>
            </div>
        </div>


        <script>

            function createStars(rating) {
                let starsHtml = '';
                for (let i = 0; i < 5; i++) {
                    let width = Math.max(0, Math.min(100, (rating - i * 2) * 50));
                    starsHtml += `<div class="star">
                        <svg class="star-empty" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M11.245 4.174C11.4765 3.50808 11.5922 3.17513 11.7634 3.08285C11.9115 3.00298 12.0898 3.00298 12.238 3.08285C12.4091 3.17513 12.5248 3.50808 12.7563 4.174L14.2866 8.57639C14.3525 8.76592 14.3854 8.86068 14.4448 8.93125C14.4972 8.99359 14.5641 9.04218 14.6396 9.07278C14.725 9.10743 14.8253 9.10947 15.0259 9.11356L19.6857 9.20852C20.3906 9.22288 20.743 9.23007 20.8837 9.36432C21.0054 9.48051 21.0605 9.65014 21.0303 9.81569C20.9955 10.007 20.7146 10.2199 20.1528 10.6459L16.4387 13.4616C16.2788 13.5829 16.1989 13.6435 16.1501 13.7217C16.107 13.7909 16.0815 13.8695 16.0757 13.9507C16.0692 14.0427 16.0982 14.1387 16.1563 14.3308L17.506 18.7919C17.7101 19.4667 17.8122 19.8041 17.728 19.9793C17.6551 20.131 17.5108 20.2358 17.344 20.2583C17.1513 20.2842 16.862 20.0829 16.2833 19.6802L12.4576 17.0181C12.2929 16.9035 12.2106 16.8462 12.1211 16.8239C12.042 16.8043 11.9593 16.8043 11.8803 16.8239C11.7908 16.8462 11.7084 16.9035 11.5437 17.0181L7.71805 19.6802C7.13937 20.0829 6.85003 20.2842 6.65733 20.2583C6.49056 20.2358 6.34626 20.131 6.27337 19.9793C6.18915 19.8041 6.29123 19.4667 6.49538 18.7919L7.84503 14.3308C7.90313 14.1387 7.93218 14.0427 7.92564 13.9507C7.91986 13.8695 7.89432 13.7909 7.85123 13.7217C7.80246 13.6435 7.72251 13.5829 7.56262 13.4616L3.84858 10.6459C3.28678 10.2199 3.00588 10.007 2.97101 9.81569C2.94082 9.65014 2.99594 9.48051 3.11767 9.36432C3.25831 9.23007 3.61074 9.22289 4.31559 9.20852L8.9754 9.11356C9.176 9.10947 9.27631 9.10743 9.36177 9.07278C9.43726 9.04218 9.50414 8.99359 9.55657 8.93125C9.61593 8.86068 9.64887 8.76592 9.71475 8.57639L11.245 4.174Z" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <div class="star-filled" style="width:${width}%">
                            <svg class="star-full" xmlns="http://www.w3.org/2000/svg">
                                <defs>
                                    <linearGradient id="starGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                        <stop offset="0%" stop-color="forestgreen" />
                                        <stop offset="100%" stop-color="aqua" />
                                    </linearGradient>
                                </defs>
                                <path d="M11.245 4.174C11.4765 3.50808 11.5922 3.17513 11.7634 3.08285C11.9115 3.00298 12.0898 3.00298 12.238 3.08285C12.4091 3.17513 12.5248 3.50808 12.7563 4.174L14.2866 8.57639C14.3525 8.76592 14.3854 8.86068 14.4448 8.93125C14.4972 8.99359 14.5641 9.04218 14.6396 9.07278C14.725 9.10743 14.8253 9.10947 15.0259 9.11356L19.6857 9.20852C20.3906 9.22288 20.743 9.23007 20.8837 9.36432C21.0054 9.48051 21.0605 9.65014 21.0303 9.81569C20.9955 10.007 20.7146 10.2199 20.1528 10.6459L16.4387 13.4616C16.2788 13.5829 16.1989 13.6435 16.1501 13.7217C16.107 13.7909 16.0815 13.8695 16.0757 13.9507C16.0692 14.0427 16.0982 14.1387 16.1563 14.3308L17.506 18.7919C17.7101 19.4667 17.8122 19.8041 17.728 19.9793C17.6551 20.131 17.5108 20.2358 17.344 20.2583C17.1513 20.2842 16.862 20.0829 16.2833 19.6802L12.4576 17.0181C12.2929 16.9035 12.2106 16.8462 12.1211 16.8239C12.042 16.8043 11.9593 16.8043 11.8803 16.8239C11.7908 16.8462 11.7084 16.9035 11.5437 17.0181L7.71805 19.6802C7.13937 20.0829 6.85003 20.2842 6.65733 20.2583C6.49056 20.2358 6.34626 20.131 6.27337 19.9793C6.18915 19.8041 6.29123 19.4667 6.49538 18.7919L7.84503 14.3308C7.90313 14.1387 7.93218 14.0427 7.92564 13.9507C7.91986 13.8695 7.89432 13.7909 7.85123 13.7217C7.80246 13.6435 7.72251 13.5829 7.56262 13.4616L3.84858 10.6459C3.28678 10.2199 3.00588 10.007 2.97101 9.81569C2.94082 9.65014 2.99594 9.48051 3.11767 9.36432C3.25831 9.23007 3.61074 9.22289 4.31559 9.20852L8.9754 9.11356C9.176 9.10947 9.27631 9.10743 9.36177 9.07278C9.43726 9.04218 9.50414 8.99359 9.55657 8.93125C9.61593 8.86068 9.64887 8.76592 9.71475 8.57639L11.245 4.174Z" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="url(#starGradient)" />
                            </svg>
                        </div>
                      </div>`;
                }

                return starsHtml;
            }

            function handleInfoClick() {
                const section = document.querySelector("section"),
                    overlay = document.querySelector(".overlay"),
                    closeBtn = document.querySelector(".close-btn");

                const title = `<p>Welcome to diagnosSys, where patient safety comes first.</p> To use our system, please read the directions and disclaimer below:`

                const directions = `<p>Enter Your Symptoms: In the text box labeled 'Enter your symptoms', type in the symptoms you're currently experiencing.</p>
                <p>Input Your Medications: Below, you will find a search bar under 'Enter your medications'. Please type the name(s) of any medications you are taking. As you type, suggestions may appear to assist you in completing the entry.</p>
                <p>Apply Filters: To refine your search results, use the 'Filters' section. Select your sex and age from the dropdown menus to provide our system with additional context, which can help in identifying the most likely cause of your symptoms.</p>
                <p>Search or Update Query: Once you have entered your information, click 'SEARCH' to proceed. If you would like to refine your results, click the thumbs-up or down buttons to indicate relevant and non-relevant drugs, and use the 'UPDATE QUERY' to receive a new set of results.</p>
                <p>Drug Information: The results provide information cards with the top adverse events, common usages, star-reviews of the drugs, median age, and the thumbs up or down ability to provide feedback on the results. Additionally, clicking on the card opens up a larger card containing more information about why the result was returned as well as specific reviews.</p>`;

                const disclaimer = `<p>Disclaimer: The information provided by our website is for informational purposes only and is not intended as a substitute for professional medical advice, diagnosis, or treatment. Always seek the advice of your physician or other qualified health provider with any questions you may have regarding a medical condition. Never disregard professional medical advice or delay in seeking it because of something you have read on this website. While we strive to provide accurate and up-to-date information, we do not guarantee the accuracy, completeness, effectiveness, or timeliness of the information provided. Reliance on any information provided by this website is solely at your own risk.</p>`;

                const students = ["Joe Ugarte", "Shreehari Srinivasan", "Zayana Khan", "Ashwin Char", "Chris Price"]
                const studentsHTML = students.map(event => `<li>${event}</li>`).join('');

                document.querySelector('.modal-title-words').textContent = "DiagnoSys";
                document.querySelector('.overlay').classList.add('active');
                document.querySelector('.modal-box').classList.add('active');
                document.querySelector('.modal-sym-words').textContent = "";
                document.querySelector('.stars-container').innerHTML = "";
                document.querySelector('.modal-symInfo').innerHTML = "";
                document.querySelector('.modal-header-positive').textContent = "";
                document.querySelector('.modal-header-adverse').textContent = "Project Members";
                document.querySelector('.modal-adverseInfo').innerHTML = studentsHTML;
                document.querySelector('.component1').innerHTML = title;
                document.querySelector('.component2').textContent = "";
                document.querySelector('.component3').innerHTML = ""
                document.querySelector('.modal-sim').textContent = ""
                document.querySelector('.component-percent1').textContent = "";
                document.querySelector('.component-percent2').textContent = "";
                document.querySelector('.component-percent3').textContent = "";
                document.querySelector('.positive-review1').innerHTML = directions;
                document.querySelector('.negative-review1').innerHTML = disclaimer;
                document.querySelector('.positive-review2').textContent = "";
                document.querySelector('.stars-pos2').innerHTML = "";
                document.querySelector('.stars-pos1').innerHTML = "";
                document.querySelector('.stars-neg1').innerHTML = "";
                document.querySelector('.negative-review2').textContent = "";
                document.querySelector('.stars-neg2').innerHTML = "";

                section.classList.add("active");
                overlay.addEventListener("click", () =>
                    section.classList.remove("active")
                );
                closeBtn.addEventListener("click", () =>
                    section.classList.remove("active")
                );

            }

            function handleCardClick(drug, description, score, top_5_ad_events, rating, median_age, usage, component1, component2, component3, component_score1, component_score2, component_score3, posrev1, posrat1, posrev2, posrat2, negrev1, negrat1, negrev2, negrat2) {
                const section = document.querySelector("section"),
                    overlay = document.querySelector(".overlay"),
                    closeBtn = document.querySelector(".close-btn");

                let starsHtml = createStars(rating)
                let starsPos1 = createStars(posrat1);
                let starsPos2 = createStars(posrat2);
                let starsNeg1 = createStars(negrat1);
                let starsNeg2 = createStars(negrat2);
                const usageHtml = usage.map(item => `<li>${item}</li>`).join('');
                const adverseEventsHtml = top_5_ad_events.map(event => `<li>${event}</li>`).join('');



                document.querySelector('.modal-title-words').textContent = drug;
                document.querySelector('.overlay').classList.add('active');
                document.querySelector('.modal-box').classList.add('active');
                document.querySelector('.modal-sym-words').textContent = "Indication";
                document.querySelector('.stars-container').innerHTML = starsHtml;
                document.querySelector('.modal-symInfo').innerHTML = usageHtml;
                document.querySelector('.modal-header-positive').textContent = "Reviews";
                document.querySelector('.modal-header-adverse').textContent = "Adverse Reactions";
                document.querySelector('.modal-adverseInfo').innerHTML = adverseEventsHtml;
                document.querySelector('.component1').textContent = component1;
                document.querySelector('.component2').textContent = component2;
                document.querySelector('.component3').textContent = component3
                document.querySelector('.modal-sim').textContent = score + "%"
                document.querySelector('.component-percent1').textContent = component_score1 + "%";
                document.querySelector('.component-percent2').textContent = component_score2 + "%";
                document.querySelector('.component-percent3').textContent = component_score3 + "%";
                if(posrev1 != "") {
                    document.querySelector('.positive-review1').textContent = posrev1;
                    document.querySelector('.stars-pos1').innerHTML = starsPos1;
                }
                else {
                    document.querySelector('.positive-review1').textContent = "No reviews available";
                    document.querySelector('.stars-pos1').innerHTML = "";
                }
                
                if (posrev2 != "") {
                    document.querySelector('.positive-review2').textContent = posrev2;
                    document.querySelector('.stars-pos2').innerHTML = starsPos2;
                }
                else {
                    document.querySelector('.positive-review2').textContent = "";
                    document.querySelector('.stars-pos2').innerHTML = "";
                }

                if(negrev1 != "" && negrev1 != posrev1) {
                    document.querySelector('.negative-review1').textContent = negrev1;
                    document.querySelector('.stars-neg1').innerHTML = starsNeg1;
                }
                else {
                    document.querySelector('.negative-review1').textContent = "";
                    document.querySelector('.stars-neg1').innerHTML = "";
                }
                
                if(negrev2 != "" && negrev2 != posrev2) {
                    document.querySelector('.negative-review2').textContent = negrev2;
                    document.querySelector('.stars-neg2').innerHTML = starsNeg2;
                }
                else {
                    document.querySelector('.negative-review2').textContent = "";
                    document.querySelector('.stars-neg2').innerHTML = "";
                }

                section.classList.add("active");
                overlay.addEventListener("click", () =>
                    section.classList.remove("active")
                );
                closeBtn.addEventListener("click", () =>
                    section.classList.remove("active")
                );

            }

            document.addEventListener('DOMContentLoaded', () => {
                const textarea = document.getElementById('filter-text-val');
                const maxHeight = 150;
                const minHeight = 42;

                const updateFieldState = () => {
                    if (textarea.value !== "" || document.activeElement === textarea) {
                        textarea.classList.add('has-content');
                    } else {
                        textarea.classList.remove('has-content');
                    }

                    const newHeight = Math.min(textarea.scrollHeight, maxHeight);
                    textarea.style.height = textarea.value ? `${newHeight}px` : `${minHeight}px`;
                };

                textarea.addEventListener('input', updateFieldState);
                textarea.addEventListener('focus', updateFieldState);
                textarea.addEventListener('blur', updateFieldState);

                updateFieldState();

                const searchButton = document.querySelector('.search-button');
                textarea.addEventListener('keydown', (event) => {
                    if (event.key === 'Enter') {
                        event.preventDefault();
                        searchButton.click();
                    }
                });

                const options = document.querySelectorAll('#options .option input[type="radio"]');
                options.forEach(function (option) {
                    option.addEventListener('change', function () {
                        if (this.checked) {
                            const label = this.nextElementSibling.textContent;

                            document.getElementById('selected-value').querySelector('span').textContent = label;

                            document.getElementById('options-view-button').checked = false;

                        }
                    });
                });

                const optionsAge = document.querySelectorAll('#optionsAge .optionAge input[type="radio"]');
                optionsAge.forEach(function (option) {
                    option.addEventListener('change', function () {
                        if (this.checked) {
                            const label = this.nextElementSibling.textContent;

                            document.getElementById('selectedAge-value').querySelector('span').textContent = label;

                            document.getElementById('optionsAge-view-button').checked = false;

                        }
                    });
                });
            });


            // FOR AUTOCOMPLETE LIST
            document.getElementById('medInput').addEventListener('input', function () {
                var input = this.value;

                if (!input) {
                    document.getElementById('autocomplete-list').innerHTML = '';
                    return;
                }

                fetch("/autocomplete?" + new URLSearchParams({ query: input }).toString())
                    .then((response) => response.json())
                    .then((data) => {
                        var suggestions = data.medications || [];
                        var autocompleteList = document.getElementById('autocomplete-list');
                        autocompleteList.innerHTML = '';

                        suggestions.forEach(item => {
                            var div = document.createElement('div');
                            div.innerHTML = item;
                            div.addEventListener('click', function () {
                                createTag(this.innerText);
                                document.getElementById('medInput').value = '';
                                autocompleteList.innerHTML = '';
                            });
                            autocompleteList.appendChild(div);
                        });
                    })
                    .catch(error => console.error('Error fetching autocomplete suggestions:', error));
            });

            document.getElementById('medInput').addEventListener('keydown', function (event) {
                if (event.key === 'Enter' && this.value) {
                    createTag(this.value);
                    this.value = '';
                    document.getElementById('autocomplete-list').innerHTML = '';
                    event.preventDefault();
                }
            });

            function createTag(text) {
                var tagList = document.getElementById('tag-list');
                var tag = document.createElement('div');
                tag.className = 'tag';
                tag.innerHTML = `<span>${text}</span><button onclick="removeTag(this)">x</button>`;
                tagList.appendChild(tag);
            }

            function removeTag(button) {
                var tag = button.parentNode;
                tag.parentNode.removeChild(tag);
            }


            function observeCards() {
                const observer = new IntersectionObserver((entries, observer) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            entry.target.style.animation = `fadeInUp 0.5s ease-out forwards`;
                            observer.unobserve(entry.target);
                        }
                    });
                }, {
                    threshold: 0.25
                });

                document.querySelectorAll('.drug-card').forEach(card => {
                    observer.observe(card);
                });
            }
            function toggleThumb(event, clickedThumb) {
                event.stopPropagation();
                const card = clickedThumb.closest('.drug-card');

                const isThumbsUp = clickedThumb.classList.contains('thumbs-up');

                const thumbsUp = card.querySelector('.thumbs-up');
                const thumbsDown = card.querySelector('.thumbs-down');

                if (clickedThumb.src.includes('white')) {
                    clickedThumb.src = clickedThumb.src.replace('white', 'green');
                } else {
                    clickedThumb.src = clickedThumb.src.replace('green', 'white');
                }

                const otherThumb = isThumbsUp ? thumbsDown : thumbsUp;
                if (otherThumb.src.includes('green')) {
                    otherThumb.src = otherThumb.src.replace('green', 'white');
                }

                document.querySelector('.search-button-update').style.display = 'inline-block';

            }




            function toggleSingleThumb(imgElement) {
                if (imgElement.src.includes('white')) {
                    imgElement.src = imgElement.src.replace('_white', '_green');
                } else {
                    imgElement.src = imgElement.src.replace('_green', '_white');
                }
            }
            function getDrugsWithGreenThumbsUp() {
                const cards = document.querySelectorAll('.drug-card');
                let drugsWithGreenThumbsUp = [];

                cards.forEach(card => {
                    const thumbsUp = card.querySelector('.thumbs-up');
                    if (thumbsUp.src.includes('green')) {
                        const drugTitle = card.querySelector('.drug-title').textContent;
                        drugsWithGreenThumbsUp.push(drugTitle);
                    }
                });

                console.log("Drugs with Thumbs Up Green:", drugsWithGreenThumbsUp);
                return drugsWithGreenThumbsUp;
            }

            function getDrugsWithGreenThumbsDown() {
                const cards = document.querySelectorAll('.drug-card');
                let drugsWithGreenThumbsDown = [];

                cards.forEach(card => {
                    const thumbsDown = card.querySelector('.thumbs-down');
                    if (thumbsDown.src.includes('green')) {
                        const drugTitle = card.querySelector('.drug-title').textContent;
                        drugsWithGreenThumbsDown.push(drugTitle);
                    }
                });

                console.log("Drugs with Thumbs Down Green:", drugsWithGreenThumbsDown);
                return drugsWithGreenThumbsDown;
            }




            function answerBoxTemplate(drug, description, score, top_5_ad_events, rating, median_age, usage, index) {
                let adverseEventsHtml = top_5_ad_events.map(event => `<li>${event}</li>`).join('');
                let usageHtml = usage.map(item => `<li>${item}</li>`).join('');
                let starsHtml = '';
                for (let i = 0; i < 5; i++) {
                    let width = Math.max(0, Math.min(100, (rating - i * 2) * 50));
                    starsHtml += `<div class="star">
                        <svg class="star-empty" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M11.245 4.174C11.4765 3.50808 11.5922 3.17513 11.7634 3.08285C11.9115 3.00298 12.0898 3.00298 12.238 3.08285C12.4091 3.17513 12.5248 3.50808 12.7563 4.174L14.2866 8.57639C14.3525 8.76592 14.3854 8.86068 14.4448 8.93125C14.4972 8.99359 14.5641 9.04218 14.6396 9.07278C14.725 9.10743 14.8253 9.10947 15.0259 9.11356L19.6857 9.20852C20.3906 9.22288 20.743 9.23007 20.8837 9.36432C21.0054 9.48051 21.0605 9.65014 21.0303 9.81569C20.9955 10.007 20.7146 10.2199 20.1528 10.6459L16.4387 13.4616C16.2788 13.5829 16.1989 13.6435 16.1501 13.7217C16.107 13.7909 16.0815 13.8695 16.0757 13.9507C16.0692 14.0427 16.0982 14.1387 16.1563 14.3308L17.506 18.7919C17.7101 19.4667 17.8122 19.8041 17.728 19.9793C17.6551 20.131 17.5108 20.2358 17.344 20.2583C17.1513 20.2842 16.862 20.0829 16.2833 19.6802L12.4576 17.0181C12.2929 16.9035 12.2106 16.8462 12.1211 16.8239C12.042 16.8043 11.9593 16.8043 11.8803 16.8239C11.7908 16.8462 11.7084 16.9035 11.5437 17.0181L7.71805 19.6802C7.13937 20.0829 6.85003 20.2842 6.65733 20.2583C6.49056 20.2358 6.34626 20.131 6.27337 19.9793C6.18915 19.8041 6.29123 19.4667 6.49538 18.7919L7.84503 14.3308C7.90313 14.1387 7.93218 14.0427 7.92564 13.9507C7.91986 13.8695 7.89432 13.7909 7.85123 13.7217C7.80246 13.6435 7.72251 13.5829 7.56262 13.4616L3.84858 10.6459C3.28678 10.2199 3.00588 10.007 2.97101 9.81569C2.94082 9.65014 2.99594 9.48051 3.11767 9.36432C3.25831 9.23007 3.61074 9.22289 4.31559 9.20852L8.9754 9.11356C9.176 9.10947 9.27631 9.10743 9.36177 9.07278C9.43726 9.04218 9.50414 8.99359 9.55657 8.93125C9.61593 8.86068 9.64887 8.76592 9.71475 8.57639L11.245 4.174Z" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <div class="star-filled" style="width:${width}%">
                            <svg class="star-full" xmlns="http://www.w3.org/2000/svg">
                                <defs>
                                    <linearGradient id="starGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                        <stop offset="0%" stop-color="forestgreen" />
                                        <stop offset="100%" stop-color="aqua" />
                                    </linearGradient>
                                </defs>
                                <path d="M11.245 4.174C11.4765 3.50808 11.5922 3.17513 11.7634 3.08285C11.9115 3.00298 12.0898 3.00298 12.238 3.08285C12.4091 3.17513 12.5248 3.50808 12.7563 4.174L14.2866 8.57639C14.3525 8.76592 14.3854 8.86068 14.4448 8.93125C14.4972 8.99359 14.5641 9.04218 14.6396 9.07278C14.725 9.10743 14.8253 9.10947 15.0259 9.11356L19.6857 9.20852C20.3906 9.22288 20.743 9.23007 20.8837 9.36432C21.0054 9.48051 21.0605 9.65014 21.0303 9.81569C20.9955 10.007 20.7146 10.2199 20.1528 10.6459L16.4387 13.4616C16.2788 13.5829 16.1989 13.6435 16.1501 13.7217C16.107 13.7909 16.0815 13.8695 16.0757 13.9507C16.0692 14.0427 16.0982 14.1387 16.1563 14.3308L17.506 18.7919C17.7101 19.4667 17.8122 19.8041 17.728 19.9793C17.6551 20.131 17.5108 20.2358 17.344 20.2583C17.1513 20.2842 16.862 20.0829 16.2833 19.6802L12.4576 17.0181C12.2929 16.9035 12.2106 16.8462 12.1211 16.8239C12.042 16.8043 11.9593 16.8043 11.8803 16.8239C11.7908 16.8462 11.7084 16.9035 11.5437 17.0181L7.71805 19.6802C7.13937 20.0829 6.85003 20.2842 6.65733 20.2583C6.49056 20.2358 6.34626 20.131 6.27337 19.9793C6.18915 19.8041 6.29123 19.4667 6.49538 18.7919L7.84503 14.3308C7.90313 14.1387 7.93218 14.0427 7.92564 13.9507C7.91986 13.8695 7.89432 13.7909 7.85123 13.7217C7.80246 13.6435 7.72251 13.5829 7.56262 13.4616L3.84858 10.6459C3.28678 10.2199 3.00588 10.007 2.97101 9.81569C2.94082 9.65014 2.99594 9.48051 3.11767 9.36432C3.25831 9.23007 3.61074 9.22289 4.31559 9.20852L8.9754 9.11356C9.176 9.10947 9.27631 9.10743 9.36177 9.07278C9.43726 9.04218 9.50414 8.99359 9.55657 8.93125C9.61593 8.86068 9.64887 8.76592 9.71475 8.57639L11.245 4.174Z" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="url(#starGradient)" />
                            </svg>
                        </div>
                      </div>`;
                }
                return `<div class='drug-card'>
                        <div class='drug-info'>
                            <div class="space">

                                <div class='space'></div>
                                <h3 class='drug-title'>${drug}</h3>
                                <div class='drug-sim'>
                                    <div class='drug-sim-score'>
                                        ${score + "%"}
                                    </div>
                                </div>
                            </div>
                            
                            <div class='row-flexing'>
                                <div class='flexing'>
                                    <p class='drug-adverse-events-title'>Top 5 Adverse Events:</p>
                                    <ul class='drug-adverse-events'>${adverseEventsHtml}</ul>
                                </div>
                                <div class='flexing'>
                                    <p class='drug-adverse-events-title'>Common Usage: </p>
                                    <ul class='drug-adverse-events'>${usageHtml}</ul>
                                </div>
                            </div>
                        </div>
                        <div class='row-flexing-bottom'>
                            <div class='drug-rating'>Rating: <div class='stars'>${starsHtml}</div></div>
                            <div class='thumbs'>
                <img src="../static/images/thumbsup_white.svg" alt="Thumbs Up" class="thumb thumbs-up" onclick="toggleThumb(event,this)" width="50" height="60"/>
                <img src="../static/images/thumbsdown_white.svg" alt="Thumbs Down" class="thumb thumbs-down" onclick="toggleThumb(event,this)" width="50" height="60"/>
            




                            </div>
                            <p class='drug-median-age'>Median Age: ${median_age}</p>
                        </div>
                        
                    </div>`;
            }


            function sendUpdateQuery() {
                const greenThumbsUpDrugs = getDrugsWithGreenThumbsUp();
                const greenThumbsDownDrugs = getDrugsWithGreenThumbsDown();
                const answerBox = document.getElementById("answer-box");
                answerBox.innerHTML = "";
                const medications = getMedications();
                const queryText = document.getElementById("filter-text-val").value;
                document.querySelector('.search-button-update').style.display = 'none';

                const dataToSend = {
                    query: queryText,
                    rel_docs: greenThumbsUpDrugs,
                    non_rel_docs: greenThumbsDownDrugs,
                    user_age: getSelectedAge(),
                    medications: JSON.stringify(medications),
                };
                const endpoint = '/update-query';

                fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(dataToSend)
                })
                    .then(response => response.json())
                    .then(data => {
                        const hasRelevantResults = data.some(row => row.score > 0);

                        if (data.length > 0 && hasRelevantResults) {
                            data.forEach((row, index) => {
                                if (row.score > 0) {
                                    let cardHTML = answerBoxTemplate(row.drug, row.definition, row.score, row.top_5_ad_events || [], row.rating, row.median_age, row.usage);
                                    let tempDiv = document.createElement("div");
                                    tempDiv.innerHTML = cardHTML;
                                    tempDiv.firstChild.style.animationDelay = `${index * 100}ms`;
                                    tempDiv.firstChild.addEventListener('click', () => handleCardClick(row.drug, row.definition, row.score, row.top_5_ad_events, row.rating, row.median_age, row.usage, row.component1, row.component2, row.component3, row.component_score1, row.component_score2, row.component_score3, row.positive_review_1, row.positive_rating_1, row.positive_review_2, row.positive_rating_2, row.negative_review_1, row.negative_rating_1, row.negative_review_2, row.negative_rating_2));
                                    answerBox.appendChild(tempDiv.firstChild);
                                }
                            });
                            observeCards();
                        } else {
                            answerBox.innerHTML = "<p class='no-results'>No results found.</p>";
                        }


                        observeCards();
                    })
                    .catch((error) => {
                        console.error('Error:', error);
                    });
            }

            function sendFocus() {
                document.getElementById('filter-text-val').focus()
            }

            function filterText() {
                document.getElementById("answer-box").innerHTML = ""
                console.log(document.getElementById("filter-text-val").value)
                fetch("/episodes?" + new URLSearchParams({ title: document.getElementById("filter-text-val").value }).toString())
                    .then((response) => response.json())
                    .then((data) => data.forEach((row, index) => {
                        const reviews = fetchReviews(row.drug.toLowerCase())
                        let cardHTML = answerBoxTemplate(row.drug, row.definition, row.score, row.top_5_ad_events || [], row.rating, row.median_age, row.usage, index);
                        let tempDiv = document.createElement("div");
                        tempDiv.innerHTML = cardHTML;
                        tempDiv.firstChild.style.animationDelay = `${index * 100}ms`;
                        tempDiv.firstChild.addEventListener('click', () => handleCardClick(row.drug, row.definition, row.score, row.top_5_ad_events, row.rating, row.median_age, row.usage, row.component1, row.component2, row.component3, row.component_score1, row.component_score2, row.component_score3, row.positive_review_1, row.positive_rating_1, row.positive_review_2, row.positive_rating_2, row.negative_review_1, row.negative_rating_1, row.negative_review_2, row.negative_rating_2));
                        answerBox.appendChild(tempDiv.firstChild);
                    }));
            }

            function getMedications() {
                const tags = document.querySelectorAll('.tag span');
                return Array.from(tags).map(tag => tag.textContent);
            }

            function getSelectedGender() {
                const genderRadios = document.querySelectorAll('input[name="gender"]:checked');
                return genderRadios.length ? genderRadios[0].value : "male";
            }

            function getSelectedAge() {
                const ageRadios = document.querySelectorAll('input[name="Age"]:checked');
                return ageRadios.length ? ageRadios[0].value : "50";
            }

            function filterTextDrug() {
                const answerBox = document.getElementById("answer-box");
                answerBox.innerHTML = ""; 

                const searchText = document.getElementById("filter-text-val").value;
                const age = getSelectedAge();
                const gender = getSelectedGender();
                const medications = getMedications();

                fetch("/drugs?" + new URLSearchParams({
                    query: searchText,
                    gender: gender,
                    age: age,
                    medications: JSON.stringify(medications)
                }).toString())
                    .then(response => response.json())
                    .then(data => {
                        const hasRelevantResults = data.some(row => row.score > 0);

                        if (data.length > 0 && hasRelevantResults) {
                            data.forEach((row, index) => {
                                if (row.score > 0) {
                                    let cardHTML = answerBoxTemplate(row.drug, row.definition, row.score, row.top_5_ad_events || [], row.rating, row.median_age, row.usage);
                                    let tempDiv = document.createElement("div");
                                    tempDiv.innerHTML = cardHTML;
                                    tempDiv.firstChild.style.animationDelay = `${index * 100}ms`;
                                    tempDiv.firstChild.addEventListener('click', () => handleCardClick(row.drug, row.definition, row.score, row.top_5_ad_events, row.rating, row.median_age, row.usage, row.component1, row.component2, row.component3, row.component_score1, row.component_score2, row.component_score3, row.positive_review_1, row.positive_rating_1, row.positive_review_2, row.positive_rating_2, row.negative_review_1, row.negative_rating_1, row.negative_review_2, row.negative_rating_2));
                                    answerBox.appendChild(tempDiv.firstChild);
                                    
                                }
                            });
                            observeCards();
                        } else {
                            answerBox.innerHTML = "<p class='no-results'>No results found.</p>";
                        }
                    })
                    .catch((error) => {
                        console.error('Error:', error);
                        answerBox.innerHTML = "<p class='error-message'>An error occurred while fetching data.</p>";
                    });
            }



        </script>
        <script type="module" src="../static/scripts/background.js"></script>
        <script src="../static/scripts/delaunay.js"></script>

</body>